线程上下文切换

在 Linux 系统下，可以使用 Linux 内核提供的 vmstat 命令，来监视 Java 程序运行过程中系统的上下文切换频率，cs 如下图所示:

vmstat 2   2秒执行一次

如果是监视某个应用的上下文切换，就可以使用 pidstat 命令监控指定进程的 Context Switch 上下文切换：

pidstat -w -l -p pid 1 100

```
在Debian/Ubuntu系统中可以使用下面的命令来安装

# apt-get install sysstat

CentOS/Fedora/RHEL版本的linux中则使用下面的命令：

# yum install sysstat

使用pidstat不加任何参数等价于加上-p参数，但是只有正在活动的任务会被显示出来

# pidstat
PID - 被监控的任务的进程号

　　%usr - 当在用户层执行（应用程序）时这个任务的cpu使用率，和 nice 优先级无关。注意这个字段计算的cpu时间不包括在虚拟处理器中花去的时间。

　　%system - 这个任务在系统层使用时的cpu使用率。

　　%guest - 任务花费在虚拟机上的cpu使用率（运行在虚拟处理器）。

　　%CPU - 任务总的cpu使用率。在SMP环境（多处理器）中，如果在命令行中输入-I参数的话，cpu使用率会除以你的cpu数量。

　　CPU - 正在运行这个任务的处理器编号。

　　Command - 这个任务的命令名称

I/O 统计数据

　　通过使用-d参数来得到I/O的统计数据。比如：

　　# pidstat -d -p pid

　　IO 输出会显示一些内的条目：

　　kB_rd/s - 任务从硬盘上的读取速度（kb）

　　kB_wr/s - 任务向硬盘中的写入速度（kb）

　　kB_ccwr/s - 任务写入磁盘被取消的速率（kb）    

页面失败和内存使用

　　使用-r标记你能够得到内存使用情况的数据

   # pidstat -r -p pid     

    重要的条目：
    
    　　minflt/s - 从内存中加载数据时每秒出现的小的错误的数目，这些不要求从磁盘载入内存页面。
    
    　　majflt/s - 从内存中加载数据时每秒出现的较大错误的数目，这些要求从磁盘载入内存页面。
    
    　　VSZ - 虚拟容量：整个进程的虚拟内存使用（kb）
    
    　　RSS - 长期内存使用：任务的不可交换物理内存的使用量（kb）

举例

　　1. 你可以通过使用下面的命令来监测内存使用

　　# pidstat -r 2 5

　　这会给你5份关于page faults的统计数据结果，间隔2秒。这将会更容易的定位出现问题的进程。

　　2. 显示所有mysql服务器的子进程

　　# pidstat -T CHILD -C mysql

　　3. 将所有的统计数据结合到一个便于阅读的单一报告中：

　　# pidstat -urd -h
```

















